## 如何用消息队列分离功能

一般在设计微服务时，会将功能进行一些拆分到独立的服务中。两个服务之间的通信一般采用 http 或 rpc 。

不管是 http 还是 rpc 通信，都会涉及到接口，给两个服务的维护者带来一定量的麻烦。

解决这种服务之间的耦合性可以适当的采用消息队列机制。

消息（数据）的生产者将消息发送给消息队列，消息的消费者从消息队列里拿数据进行处理。在这个过程中只需要定义好消息的结构体即可进行通信。

采用消息队列不仅可以解决服务之间的耦合性，还能在并发量比较大的时候获得流量消峰的效果。

该项目（sample）采用 redis 当着消息队列，分别起了3个服务。

1. consumer.js 消息的消费者服务（收到消息后发送邮件）
2. producer.js 消息的生产者服务（没10s产生一个消息）
3. monitor.js 消息队列监控服务

#### startup

1. 启动一个 redis 服务。
2. 修改配置文件 ./config.index.js
3. 修改 ./consumer.js 的邮件配置
3. 启动项目

  ```
  $ pm2 start process.yml
  ```

4. 查看监控页面 localhost:30000
